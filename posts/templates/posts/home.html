{% load static %} {% load humanize %} {% load time_filters %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Crow â€” Community Feed</title>

    <!-- Home Page CSS -->
    <link rel="stylesheet" href="{% static 'posts/css/home.css' %}" />

    <!-- Optional clean font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <!-- MAIN FEED CONTAINER -->
    <div class="feed-wrapper">
      <h1 class="page-title">Crow ðŸª¶ Community Feed</h1>

      <!-- SUCCESS MESSAGES -->
      {% if messages %} {% for message in messages %}
      <div class="flash-message">{{ message }}</div>
      {% endfor %} {% endif %}

{% for post in posts %}
<div class="post-card">

    <!-- POST HEADER -->
    <div class="post-header">
        <img src="https://ui-avatars.com/api/?name={{ post.author.username }}" class="post-avatar" />

        <div class="post-meta">
            <span class="post-author">{{ post.author.username }}</span>
            <span class="post-time">â€¢{{ post.created_at|naturaltime|clean_time }}</span>

            {% if post.category %}
            <span class="post-category">{{ post.category.name }}</span>
            {% endif %}
        </div>
    </div>

    <!-- POST TITLE -->
    <h2 class="post-title">{{ post.title }}</h2>

    <!-- POST CONTENT -->
    <p class="post-content">{{ post.content }}</p>

    <!-- ACTION BAR (LIKE REDDIT) -->
    <div class="post-actions">
    <div class="vote-box">
        <button class="vote-btn">â–²</button>
        <span class="vote-count">{{ post.upvotes }}</span>
        <button class="vote-btn">â–¼</button>
    </div>

    <div class="action-btn">ðŸ’¬ <span>Comments</span></div>
    <div class="action-btn">â†— <span>Share</span></div>
</div>

<!-- COMMENTS SECTION -->
<div class="comments-section">

    <!-- ADD COMMENT -->
    <form method="post" action="{% url 'add_comment' post.id %}" class="comment-form">
        {% csrf_token %}
        <textarea name="content" placeholder="Write a comment..." class="comment-input"></textarea>
        <button type="submit" class="comment-submit">Comment</button>
    </form>

    <!-- DISPLAY COMMENTS -->
    <div class="comment-list">
        {% for comment in post.comments.all %}
            <div class="comment-box">

                <div class="comment-author">
                    {{ comment.author.username }} â€¢ {{ comment.created_at|naturaltime }}
                </div>

                <div class="comment-content">{{ comment.content }}</div>

                <!-- REPLY BUTTON -->
                <button class="reply-toggle" data-id="{{ comment.id }}">Reply</button>

                <!-- REPLY FORM -->
                <form method="post"
                      action="{% url 'reply_comment' comment.id %}"
                      id="reply-form-{{ comment.id }}"
                      class="reply-form"
                      style="display: none;">
                    {% csrf_token %}
                    <textarea name="content" placeholder="Write a reply..." class="reply-input"></textarea>
                    <button type="submit" class="reply-submit">Reply</button>
                </form>

                <!-- DISPLAY REPLIES -->
                {% for reply in comment.replies.all %}
                    <div class="reply-box">
                        <div class="reply-author">
                            {{ reply.author.username }} â€¢ {{ reply.created_at|naturaltime }}
                        </div>
                        <div class="reply-content">{{ reply.content }}</div>
                    </div>
                {% endfor %}
            </div>
        {% endfor %}
    </div>
</div>

</div>
{% empty %}
<p class="no-posts">No posts yet. Be the first to share something!</p>
{% endfor %}

      </div>
    </div>

    <!-- Home JS -->
    <script src="{% static 'posts/js/home.js' %}"></script>
  </body>
</html>
